@if(solicitacao){
  <div class="flex flex-col gap-3 w-full h-full">
    <a class="flex justify-center items-center p-2 bg-white rounded-lg shadow-lg w-12 hover:bg-gray-50" [routerLink]="['/tela-inicial-funcionario']" >
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="stroke-gray-800" xmlns="http://www.w3.org/2000/svg">
      <path d="M15 19L8 12L15 5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </a>

    <div class="flex gap-5 h-full overflow-hidden">
      <div class="bg-white rounded-lg w-2/3 shadow-lg p-10 flex flex-col gap-8">
        <h2 class="text-gray-800 font-bold text-2xl">Detalhes</h2>
        
        <div class="flex gap-6">
          <div class="w-1/2 space-y-2 border-1 border-gray-200 rounded-lg p-3">
            <div class="flex items-center gap-3">
              <h3 class="font-sabe text-sm text-gray-600">Informações da solicitação </h3>
              <svg width="18" height="18" viewBox="0 0 40 40" fill="none" class="stroke-gray-600 " xmlns="http://www.w3.org/2000/svg">
                <path d="M20 13.3333V20M20 26.6667H20.0167M35 20C35 28.2843 28.2843 35 20 35C11.7157 35 5 28.2843 5 20C5 11.7157 11.7157 5 20 5C28.2843 5 35 11.7157 35 20Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>

            <div class="grid grid-cols-2 gap-2">
              <div class="col-span-1 flex flex-col">
                <span class="font-medium text-sm text-gray-700">ID</span> 
                <p class="text-gray-800 text-base font-thin">#{{ solicitacao.id }}</p>
              </div>

              <div class="col-span-1 flex flex-col">
                <span class="font-medium text-sm text-gray-700">Equipamento</span> 
                <p class="text-gray-800 text-base font-thin">{{ solicitacao.equipamento }}</p>
              </div>

              <div class="col-span-2 flex flex-col">
                <span class="font-medium text-sm text-gray-700">Categoria</span> 
                <p class="text-gray-800 text-base font-thin">{{ solicitacao?.categoria }}</p>
              </div>

              <div class="col-span-2 flex flex-col">
                <span class="font-medium text-sm text-gray-700">Descrição</span> 
                <p class="text-gray-800 text-base font-thin">{{ solicitacao.descricao }}</p>
              </div>
            </div>
          </div>

          <div class="w-1/2 space-y-2 border-1 border-gray-200 rounded-lg p-3">
            <div class="flex items-center gap-3">
              <h3 class="font-sabe text-sm text-gray-600">Informações do cliente </h3>
              <svg width="18" height="18" viewBox="0 0 40 40" fill="none" class="stroke-gray-600 " xmlns="http://www.w3.org/2000/svg">
                <path d="M20 13.3333V20M20 26.6667H20.0167M35 20C35 28.2843 28.2843 35 20 35C11.7157 35 5 28.2843 5 20C5 11.7157 11.7157 5 20 5C28.2843 5 35 11.7157 35 20Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>

            <div class="grid grid-cols-2 gap-2">
              <div class="flex flex-col col-span-1">
                <span class="font-medium text-sm text-gray-700">Nome</span> 
                <p class="text-gray-800 text-base font-thin">{{ solicitacao.cliente.nome }}</p>
              </div>

              <div class="flex flex-col col-span-">
                <span class="font-medium text-sm text-gray-700">CPF</span> 
                <p class="text-gray-800 text-base font-thin">{{ solicitacao.cliente.cpf | cpfFormatador }}</p>
              </div>

              <div class="flex flex-col col-span-2">
                <span class="font-medium text-sm text-gray-700">Telefone</span> 
                <p class="text-gray-800 text-base font-thin">{{ solicitacao.cliente.telefone | telefoneFormatador }}</p>
              </div>

              <div class="flex flex-col col-span-2">
                <span class="font-medium text-sm text-gray-700">Endereço</span> 
                <p class="text-gray-800 text-base font-thin">{{ solicitacao.cliente.endereco | enderecoFormatador }}</p>
              </div>
            </div>
          </div>
        </div>

        <div class="flex flex-col gap-3 overflow-hidden">
          <div class="flex items-center gap-2">
            <h3 class="font-sabe text-sm text-gray-600">Orçamento</h3>
            <svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 -960 960 960" width="18" class="stroke-gray-600"><path d="M459.38-215.38h39.24v-46.93q43.07-3.61 82.53-30.92 39.47-27.31 39.47-84.77 0-42-25.54-71.62-25.54-29.61-97.54-55.61-66.16-23.08-84.54-39.62-18.38-16.53-18.38-47.15 0-30.62 23.88-51t63.5-20.38q30.46 0 50.77 13.96 20.31 13.96 32.92 35.42l34.77-13.69q-14.08-28.85-41.27-48.31-27.19-19.46-58.57-21.69v-46.93h-39.24v46.93q-52.3 8.69-79.15 39-26.85 30.31-26.85 66.69 0 43.15 27.12 69.08Q409.62-497 474-473.69q64.54 23.77 86.73 42.92 22.19 19.15 22.19 52.77 0 42.23-30.8 60.81-30.81 18.57-66.12 18.57-34.54 0-62.35-20.11-27.8-20.12-44.42-57.27L344-360.77q17.08 41.08 45.81 64.04 28.73 22.96 69.57 32.42v48.93ZM480-120q-74.54 0-140.23-28.42-65.69-28.43-114.31-77.04-48.61-48.62-77.04-114.31Q120-405.46 120-480q0-74.54 28.42-140.23 28.43-65.69 77.04-114.31 48.62-48.61 114.31-77.04Q405.46-840 480-840q74.54 0 140.23 28.42 65.69 28.43 114.31 77.04 48.61 48.62 77.04 114.31Q840-554.54 840-480q0 74.54-28.42 140.23-28.43 65.69-77.04 114.31-48.62 48.61-114.31 77.04Q554.54-120 480-120Zm0-40q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>
          </div>

          @if (solicitacao.orcamento) {
            <div class="overflow-auto">
              <table class="w-full table-fixed">
                <thead class="border-b border-gray-200 text-gray-700 text-xs font-semibold uppercase">
                  <tr>
                    <th class="px-3 py-2 text-left">Serviço</th>
                    <th class="px-3 py-2 text-left">Preço (R$)</th>
                  </tr>
                </thead>
                <tbody class="text-gray-600 text-sm">
                  @for (servico of solicitacao.orcamento.servicos; track i; let i = $index) {
                    <tr class="hover:bg-gray-50 transition-colors border-b border-gray-200 text-sm">
                      <td class="px-3 py-2">{{ servico.descricao }}</td>
                      <td class="px-3 py-2">{{ servico.preco | currency:'BRL' }}</td>
                    </tr>
                  }
                </tbody>
                <tfoot>
                  <tr class="text-gray-700 text-sm font-bold uppercase">
                    <td class="px-3 py-2 text-right">Total</td>
                    <td class="px-3 py-2">{{ solicitacao.orcamento.valorTotal | currency:'BRL' }}</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          } @else {
            <p class="text-gray-600 italic mt-2">Solicitação ainda não orçada.</p>
          }
        </div>  
      </div>

      <div class="bg-white rounded-lg shadow-lg w-1/3 py-10 px-5 flex flex-col gap-10">
        <div class="flex justify-between items-center">
          <h3 class="text-gray-800 font-bold text-2xl">Histórico</h3>

          @if(podeFinalizar){
            <button 
              (click)="finalizarSolicitacao()"
              class="px-7 py-2 rounded-md text-sm font-medium text-white hover:opacity-75 hover:cursor-pointer"
              [style.background-color]="getStatusCor(StatusSolicitacao.FINALIZADA)">
              Finalizar 
            </button>
          }
        </div>

        <div class="flex flex-col gap-1 overflow-y-auto flex-1 pl-2">
          @for(historico of solicitacao.historico; track i; let i = $index; let ultimo = $last) {
            <div class="flex gap-3">
              <div class="flex flex-col gap-0.5 text-xs text-gray-500 text-right">
                <p>{{ historico.dataHora | date:'dd/MM/yyyy' }}</p>
                <span class="font-semibold">{{ historico.dataHora | date:'HH:mm' }}</span>
              </div>

              <div class="flex flex-col gap-1 justify-center items-center">
                <span class="w-4 h-4 rounded-full flex items-center justify-center text-white text-xs font-bold" [style.background-color]=" getStatusCor(historico.status) "></span>
                <div class="w-[.1rem] grow {{ ultimo ? '' : 'bg-gray-300'}}"></div>
              </div>

              <div class="flex flex-col gap-1 pb-5">
                <p class="text-gray-600 text-base font-thin">{{ getStatusObservacao(historico.status) }}</p>

                <p class="text-xs font-semibold" [style.color]=" getStatusCor(historico.status) ">
                  {{ getStatusLabel(historico.status) }}
                </p>

                @if(historico.funcionario && !historico.funcionarioDestino){
                  <p class="text-gray-700 text-xs pt-2">Sob responsabilidade de <span class="font-semibold">{{ historico.funcionario.nome }}</span></p>
                }

                @if(historico.funcionarioDestino){
                  <div class="justify-center text-sm flex items-center gap-2 pt-2">
                    <div class="flex flex-col gap-1">
                      <span class="text-sm font-light">{{ historico.funcionario?.nome }}</span>
                      <span class="text-xs font-semibold">Origem</span>
                    </div>
                    
                    <svg xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 -960 960 960" width="22px" fill="currentColor" [style.color]=" getStatusCor(historico.status) "><path d="M504-480 348-636q-11-11-11-28t11-28q11-11 28-11t28 11l184 184q6 6 8.5 13t2.5 15q0 8-2.5 15t-8.5 13L404-268q-11 11-28 11t-28-11q-11-11-11-28t11-28l156-156Z"/></svg>
                    <div class="flex flex-col gap-1">
                      <span class="text-sm font-light">{{ historico.funcionarioDestino.nome }}</span>
                      <span class="text-xs font-semibold">Destino</span>
                    </div>
                  </div>

                }

                @if(solicitacao.orcamento?.msgRejeicao && ( getStatusLabel(historico.status) == StatusSolicitacaoLabel[4])){
                  <div class="flex gap-1 justify-center items-center pt-2">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 -960 960 960" width="16px" fill="currentColor" [style.color]="getStatusCor(historico.status)"><path d="M109-120q-11 0-20-5.5T75-140q-5-9-5.5-19.5T75-180l370-640q6-10 15.5-15t19.5-5q10 0 19.5 5t15.5 15l370 640q6 10 5.5 20.5T885-140q-5 9-14 14.5t-20 5.5H109Zm69-80h604L480-720 178-200Zm302-40q17 0 28.5-11.5T520-280q0-17-11.5-28.5T480-320q-17 0-28.5 11.5T440-280q0 17 11.5 28.5T480-240Zm0-120q17 0 28.5-11.5T520-400v-120q0-17-11.5-28.5T480-560q-17 0-28.5 11.5T440-520v120q0 17 11.5 28.5T480-360Zm0-100Z"/></svg>
                    <p class="text-gray-700 text-xs font-semibold">Motivo da rejeição: <span class="font-light">{{ solicitacao.orcamento?.msgRejeicao }}</span></p>
                  </div>
                }
              </div>
            </div>
          }
        </div>

        <div class="flex justify-end gap-5">
          @if(podeFazerManutencao){
            <button 
              (click)="mostrarFormularioManutencao()"
              class="px-3 py-2 rounded-md text-sm font-medium text-white w-40 hover:opacity-75 hover:cursor-pointer"
              [style.background-color]="getStatusCor(StatusSolicitacao.ARRUMADA)">
              Arrumar
            </button>
          }
    
          @if(podeRedirecionar){
            <button
              (click)="mostrarModalRedirecionamento()"
              class="px-3 py-2 rounded-md text-sm font-medium text-white w-40 hover:opacity-75 hover:cursor-pointer"
              [style.background-color]="getStatusCor(StatusSolicitacao.REDIRECIONADA)">
              Redirecionar
            </button>
          }
        </div>

        @if (mostrarFormulario) {
          <div class="fixed inset-0 flex items-center justify-center bg-black/60 z-50">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
              <form #formManutencao="ngForm" (ngSubmit)="salvarManutencao()">
                <div>
                  <h2 class="text-base/7 font-semibold text-gray-900">Realizar manutenção</h2>
            
                  <div class="col-span-6 mt-1.5">
                    <input id="descricao" placeholder="Descrição da Manutenção" type="text" name="descricao" [(ngModel)]="manutencao.descricao" #descricao="ngModel" required class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 placeholder:text-gray-400 sm:text-sm/6 outline-none focus:border-2 focus:border-gray-400"
                    />
                  </div>
            
                  <div class="col-span-6 mt-1.5">
                    <input id="orientacoes" placeholder="Orientações para o Cliente" type="text" name="orientacoes" [(ngModel)]="manutencao.orientacao" #orientacoes="ngModel" required class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 placeholder:text-gray-400 sm:text-sm/6 outline-none focus:border-2 focus:border-gray-400"
                    />
                  </div>
            
                  <div class="mt-6 flex items-center justify-end gap-x-6">
                    <button type="button" (click)="cancelarManutencao()" class="text-sm/6 font-semibold text-gray-900">Cancel</button>
                    <button type="submit" [disabled]="formManutencao.invalid" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Salvar</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        }

        @if (mostrarRedirecionamento) {
          <div class="fixed inset-0 flex items-center justify-center bg-black/60 z-50">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
              <h2 class="text-base/7 font-semibold text-gray-900 mb-4">Redirecionar serviço</h2>

              <div class="mb-4">
                <label for="funcionarioDestino" class="block text-sm font-medium text-gray-700">Funcionário</label>
                <select id="funcionarioDestino" [(ngModel)]="funcionarioDestinoSelecionado" class="mt-1 block w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-base text-gray-900">
                  <option [value]="-1">Selecione um funcionário</option>
                  
                  @for(funcionario of funcionarios; track funcionario.id){  
                    @if(funcionario.id !== funcionarioLogado.id){
                      <option [value]="funcionario.id">{{ funcionario.nome }}</option>
                    }
                  }
                </select>
              </div>

              <div class="flex justify-end gap-x-4">
                <button type="button" (click)="cancelarRedirecionamento()" class="text-gray-700">Cancelar</button>
                <button type="button" (click)="salvarRedirecionamento()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-500">Salvar</button>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}