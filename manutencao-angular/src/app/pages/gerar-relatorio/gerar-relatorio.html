<div class="flex flex-col gap-3 shadow-lg px-10 py-10 bg-white rounded-lg h-full">
  @if(loading){
    <app-elemento-loading></app-elemento-loading>
  }

  <div class="flex flex-col gap-5">
    <h2 class="text-gray-800 font-bold text-2xl">Relatórios</h2>

    <div class="flex justify-between h-30">
      <div class="relative space-y-2 border-1 border-gray-200 rounded-lg p-3 w-1/5">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-sabe text-sm text-gray-600">Clientes cadastrados</h3>
          
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" class="fill-gray-600"><path d="M730-540H630q-8.5 0-14.25-5.76T610-560.03q0-8.51 5.75-14.24T630-580h100v-100q0-8.5 5.76-14.25t14.27-5.75q8.51 0 14.24 5.75T770-680v100h100q8.5 0 14.25 5.76t5.75 14.27q0 8.51-5.75 14.24T870-540H770v100q0 8.5-5.76 14.25T749.97-420q-8.51 0-14.24-5.75T730-440v-100Zm-370 35.38q-49.5 0-84.75-35.25T240-624.62q0-49.5 35.25-84.75T360-744.62q49.5 0 84.75 35.25T480-624.62q0 49.5-35.25 84.75T360-504.62ZM80-256.92v-24.31q0-24.77 14.42-46.35 14.43-21.57 38.81-33.5 56.62-27.15 113.31-40.73 56.69-13.57 113.46-13.57 56.77 0 113.46 13.57 56.69 13.58 113.31 40.73 24.38 11.93 38.81 33.5Q640-306 640-281.23v24.31q0 17.61-11.96 29.57-11.96 11.97-29.58 11.97H121.54q-17.62 0-29.58-11.97Q80-239.31 80-256.92Zm40 1.54h480v-25.85q0-13.31-8.58-25-8.57-11.69-23.73-19.77-49.38-23.92-101.83-36.65-52.45-12.73-105.86-12.73t-105.86 12.73Q201.69-349.92 152.31-326q-15.16 8.08-23.73 19.77-8.58 11.69-8.58 25v25.85Zm240-289.24q33 0 56.5-23.5t23.5-56.5q0-33-23.5-56.5t-56.5-23.5q-33 0-56.5 23.5t-23.5 56.5q0 33 23.5 56.5t56.5 23.5Zm0-80Zm0 369.24Z"/></svg>
        </div>

        <div class="flex justify-center items-center">
          @if(loadingClientes){
            <app-elemento-loading-card [cor]="'#89A8B2'"></app-elemento-loading-card>
          } @else {
            <span class="font-medium text-2xl text-gray-700 pt-5">{{ qtClientes }}</span>
          }
        </div>
      </div>

      <div class="relative space-y-2 border-1 border-gray-200 rounded-lg p-3 w-1/5">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-sabe text-sm text-gray-600">Funcionários cadastrados</h3>
          
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" class="fill-gray-600"><path d="M184.62-160q-27.62 0-46.12-18.5Q120-197 120-224.62v-390.76q0-27.62 18.5-46.12Q157-680 184.62-680H360v-55.39q0-27.61 18.5-46.11t46.12-18.5h110.76q27.62 0 46.12 18.5Q600-763 600-735.39V-680h175.38q27.62 0 46.12 18.5Q840-643 840-615.38v390.76q0 27.62-18.5 46.12Q803-160 775.38-160H184.62Zm0-40h590.76q9.24 0 16.93-7.69 7.69-7.69 7.69-16.93v-390.76q0-9.24-7.69-16.93-7.69-7.69-16.93-7.69H184.62q-9.24 0-16.93 7.69-7.69 7.69-7.69 16.93v390.76q0 9.24 7.69 16.93 7.69 7.69 16.93 7.69ZM400-680h160v-55.39q0-9.23-7.69-16.92-7.69-7.69-16.93-7.69H424.62q-9.24 0-16.93 7.69-7.69 7.69-7.69 16.92V-680ZM160-200v-440 440Z"/></svg>
        </div>

        <div class="flex justify-center items-center">
          @if(loadingFuncionarios){
            <app-elemento-loading-card [cor]="'#BFA2DB'"></app-elemento-loading-card>
          } @else {
            <span class="font-medium text-2xl text-gray-700 pt-5">{{ qtFuncionarios }}</span>
          }
        </div>
      </div>

      <div class="relative space-y-2 border-1 border-gray-200 rounded-lg p-3 w-1/5">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-sabe text-sm text-gray-600">Solicitações finalizadas</h3>
          
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" class="fill-gray-600"><path d="M313.08-534.62q-46.85 0-79.96-33.11Q200-600.85 200-647.69q0-46.85 33.12-79.96 33.11-33.12 79.96-33.12 46.84 0 79.96 33.12 33.11 33.11 33.11 79.96 0 46.84-33.11 79.96-33.12 33.11-79.96 33.11Zm-.05-40q30.43 0 51.78-21.3 21.34-21.3 21.34-51.73 0-30.43-21.3-51.77-21.3-21.35-51.73-21.35-30.43 0-51.77 21.3Q240-678.17 240-647.74q0 30.43 21.3 51.78 21.3 21.34 51.73 21.34ZM647.69-200q-46.84 0-79.96-33.12-33.11-33.11-33.11-79.96 0-46.84 33.11-79.96 33.12-33.11 79.96-33.11 46.85 0 79.96 33.11 33.12 33.12 33.12 79.96 0 46.85-33.12 79.96Q694.54-200 647.69-200Zm-.04-40q30.43 0 51.77-21.3 21.35-21.3 21.35-51.73 0-30.43-21.3-51.78-21.3-21.34-51.73-21.34-30.43 0-51.78 21.3-21.34 21.3-21.34 51.73 0 30.43 21.3 51.77Q617.22-240 647.65-240Zm-425.8 18.15q-5.62-5.61-5.62-13.89 0-8.29 5.62-13.64l490.3-490.31q5.62-5.62 13.39-5.23 7.77.38 13.38 6 5.62 5.61 5.62 13.89 0 8.29-5.62 13.65l-490.3 490.3q-5.62 5.62-13.39 5.23-7.77-.38-13.38-6Z"/></svg>
        </div>

        <div class="flex justify-center items-center">
          @if(loadingPorcentagem){
            <app-elemento-loading-card [cor]="'#F5B17B'"></app-elemento-loading-card>
          } @else {
            <span class="font-medium text-2xl text-gray-700 pt-5">{{ percentualFinalizadas | number:'1.0-2' }}%</span>
          }
        </div>
      </div>

      <div class="relative space-y-2 border-1 border-gray-200 rounded-lg p-3 w-1/5">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-sabe text-sm text-gray-600">Receita total</h3>
          
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" class="fill-gray-600"><path d="M540-463.08q-33.85 0-56.92-23.07Q460-509.23 460-543.08q0-33.84 23.08-56.92 23.07-23.08 56.92-23.08T596.92-600Q620-576.92 620-543.08q0 33.85-23.08 56.93-23.07 23.07-56.92 23.07Zm-247.69 127.7q-26.66 0-45.64-18.99-18.98-18.98-18.98-45.63v-286.15q0-26.66 18.98-45.64t45.64-18.98h495.38q26.66 0 45.64 18.98t18.98 45.64V-400q0 26.65-18.98 45.63-18.98 18.99-45.64 18.99H292.31Zm40-40h415.38q0-26.85 18.98-45.74Q785.65-440 812.31-440v-206.15q-26.85 0-45.73-18.98-18.89-18.99-18.89-45.64H332.31q0 26.85-18.98 45.73-18.98 18.89-45.64 18.89V-440q26.85 0 45.73 18.98 18.89 18.98 18.89 45.64Zm381.54 160H172.31q-26.66 0-45.64-18.99-18.98-18.98-18.98-45.63v-332.31q0-8.5 5.76-14.25t14.27-5.75q8.51 0 14.24 5.75t5.73 14.25V-280q0 9.23 7.69 16.92 7.7 7.7 16.93 7.7h541.54q8.5 0 14.25 5.75 5.75 5.76 5.75 14.27t-5.75 14.24q-5.75 5.74-14.25 5.74Zm-421.54-160h-24.62v-335.39h24.62q-10 0-17.31 7.31-7.31 7.31-7.31 17.31V-400q0 10 7.31 17.31 7.31 7.31 17.31 7.31Z"/></svg>
        </div>

        <div class="flex justify-center items-center">
          @if(loadingReceita){
            <app-elemento-loading-card [cor]="'#96A78D'"></app-elemento-loading-card>
          } @else {
            <span class="font-medium text-2xl text-gray-700 pt-5">{{ receitaTotal | currency: 'BRL'}}</span>
          }
        </div>
      </div>
    </div>

    <div class="flex gap-10 justify-end">
      <button class="py-1.5 px-2.5 rounded flex items-center justify-center group bg-gray-800 text-white font-normal text-base hover:bg-gray-700 hover:cursor-pointer"
        (click)="mostrarReceita = true; mostrarCategoria = false; gerarReceita()">Relatório de Receita</button>
      <button class="py-1.5 px-2.5 rounded flex items-center justify-center group bg-gray-800 text-white font-normal text-base hover:bg-gray-700 hover:cursor-pointer"
        (click)="mostrarReceita = false; mostrarCategoria = true; gerarPorCategoria()">Relatório por Categoria</button>
    </div>
  </div>

    @if(mostrarReceita) {
      <div class="flex flex-col gap-6 items-start">
        <div class="flex gap-15 w-full items-end">
          <div class="flex flex-col gap-2">
            <label class="text-sm text-gray-700 font-semibold">Período:</label>

            <div class="flex justify-center items-center gap-2">
              <input type="date" [(ngModel)]="dataInicial" id="dataInicial" class="bg-gray-100 text-sm p-2 cursor-pointer rounded-md outline-0 hover:bg-gray-200 text-gray-600" />

              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" class="fill-gray-500"><path d="M682.92-460H220q-8.54 0-14.27-5.73T200-480q0-8.54 5.73-14.27T220-500h462.92L533.54-649.38q-5.85-5.85-6.12-13.77-.27-7.93 6.12-14.54 6.61-6.62 14.27-6.73 7.65-.12 14.27 6.5l175.3 175.3q5.24 5.24 7.35 10.7 2.12 5.46 2.12 11.92t-2.12 11.92q-2.11 5.46-7.35 10.7l-175.3 175.3q-5.85 5.85-13.89 6.12-8.04.27-14.65-6.35-6.39-6.61-6.5-14.15-.12-7.54 6.5-14.16L682.92-460Z"/></svg>

              <input id="dataFinal" type="date" [(ngModel)]="dataFinal" class="bg-gray-100 text-sm p-2 cursor-pointer rounded-md outline-0 hover:bg-gray-200 text-gray-600" />
            </div>
          </div>
          
          <button class="px-4 h-10 rounded bg-gray-800 text-white font-normal text-base hover:bg-gray-700 hover:cursor-pointer" (click)="gerarReceita()">Filtrar</button>
        </div>

        <div class="bg-white overflow-x-auto h-60 w-full overflow-y-auto border border-gray-200 text-gray-800 border-1 border-gray-200 rounded-lg p-8">
          <h4 class="font-bold text-xl mb-5 flex items-center gap-2">
            Receita por Dia
          </h4>

          <div class="flex flex-col gap-6">
            @for (grupo of solicitacoesAgrupadas | keyvalue; track grupo.key) {
              <div class="mb-4 p-5 bg-white rounded-xl border border-gray-400 shadow-md">
                <div class="flex justify-between items-center mb-3">
                  <h3 class="font-bold text-lg text-gray-700">
                    {{ grupo.key | date: 'dd/MM/yyyy' }}
                  </h3>

                  <span class="px-3 py-1 bg-white border border-green-300 rounded-lg text-gray-800 font-semibold">
                    {{ grupo.value.total | currency:'BRL' }}
                  </span>
                </div>

                <ul class="pl-6 space-y-1 list-disc marker:text-green-600 text-gray-700">
                  @for (item of grupo.value.lista; track item.id) {
                    <li>
                      <span class="font-medium">ID:</span> {{ item.id }} —
                      <span class="font-medium">Valor:</span> {{ item.orcamento?.valorTotal | currency:'BRL' }}
                    </li>
                  }
                </ul>
              </div>
            }
          </div>

          <div class="mt-6 text-right">
            <span class="text-gray-700 text-lg font-semibold">Total: </span>
            <span class="text-green-600 text-xl font-bold">{{ receitaTotal | currency:'BRL' }}</span>
          </div>
        </div>

        <button class="py-1.5 px-2.5 rounded bg-gray-800 text-white font-normal text-base hover:bg-gray-700 hover:cursor-pointer" (click)="downloadReceitaPDF()">Download PDF</button>
      </div>
    }

    
    @if(mostrarCategoria){
      <div class="flex flex-col gap-6 items-start mt-10">
        <div class="bg-white overflow-x-auto h-70 w-full overflow-y-auto border border-gray-200 text-gray-800 border-1 border-rgay-200 rounded-lg p-8 ">
          <h4 class="font-bold text-xl mb-5 flex items-center gap-2"> Receita por Categoria</h4>

          <div class="flex flex-col gap-6">
            @for (categoria of solicitacoesAgrupadas | keyvalue; track categoria.key) {

              <div class="mb-4 p-5 bg-white rounded-xl border border-gray-400 shadow-md">
                <div class="flex justify-between items-center mb-3">
                  <h3 class="font-bold text-lg text-gray-700">
                    {{ categoria.key }}
                  </h3>

                  <span class="px-3 py-1 bg-white border border-green-300 rounded-lg text-gray-800 font-semibold">
                    {{ categoria.value.total | currency:'BRL' }}
                  </span>
                </div>

                <ul class="pl-6 space-y-1 list-disc marker:text-green-600 text-gray-700">
                  @for (item of categoria.value.lista; track item.id) {
                    <li>
                      <span class="font-medium">ID:</span> {{ item.id }} —
                      <span class="font-medium">Valor:</span> {{ item.orcamento?.valorTotal | currency:'BRL' }}
                    </li>
                  }
                </ul>
              </div>

            }
          </div>

          <div class="mt-6 text-right">
            <span class="text-gray-700 text-lg font-semibold">Total: </span>
            <span class="text-green-600 text-xl font-bold">{{ receitaTotal | currency:'BRL' }}</span>
          </div>
        </div>  

        <button class="py-1.5 px-2.5 rounded bg-gray-800 text-white font-normal text-base hover:bg-gray-700 hover:cursor-pointer" (click)="downloadCategoriaPDF()">Download PDF</button>
      </div>
    }

    <div *ngIf="!mostrarReceita && !mostrarCategoria"
      class="bg-blue-50 border border-blue-400 text-blue-800 px-6 py-4 rounded-lg mt-6 shadow">
      Selecione um relatório para visualizar os dados.
  </div>
</div>